<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Email Tone Classifier â€” Enhanced UI</title>

    <!-- Bootstrap CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      body { background: #f5f7fb; }
      .card { border-radius: 15px; }
      .tone-badge { font-size: 1rem; padding: 8px 14px; border-radius: 20px; }
      .highlight { font-weight: bold; padding: 2px 4px; border-radius: 4px; }
    </style>
  </head>

  <body>
    <div class="container py-5">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="card shadow p-4">
            <h2 class="mb-3 text-center">ðŸ“§ Email Tone Classifier</h2>
            <p class="text-center text-muted">Enhanced UI â€” Tone colors, icons & keyword highlighting</p>

            <textarea id="emailText" class="form-control mb-3" rows="5">
Dear Sir/Madam, I am writing to request an update regarding my application status.
            </textarea>

            <div class="d-grid">
              <button class="btn btn-primary btn-lg" onclick="classify()">Analyze Tone</button>
            </div>

            <div id="resultBox" class="mt-4 p-3 rounded" style="display:none; background:#eef2ff;">
              <h5>
                Predicted Tone:
                <span id="toneLabel" class="tone-badge text-white"></span>
              </h5>

              <h6 id="toneIcon" class="mt-2"></h6>

              <p class="text-muted mb-2">
                Method:
                <span id="methodLabel"></span>
              </p>

              <h6 class="mt-3">Highlighted Text:</h6>
              <div id="highlightBox" class="p-2 bg-white rounded" style="white-space: pre-wrap;"></div>
            </div>

            <canvas id="confidenceChart" class="mt-4" style="display:none; height:300px;"></canvas>

          </div>
        </div>
      </div>
    </div>

    <script>
      let chartInstance = null;

      const toneColors = {
        positive: "#00b894",
        appreciative: "#0097a7",
        polite: "#0984e3",
        formal: "#6c5ce7",
        neutral: "#636e72",
        negative: "#e17055",
        rude: "#d63031",
        urgent: "#e84393",
        informal: "#fdcb6e"
      };

      const toneIcons = {
        positive: "ðŸ‘ Positive",
        appreciative: "ðŸ˜Š Appreciative",
        polite: "ðŸ™ Polite",
        formal: "ðŸ’¼ Formal",
        neutral: "âšª Neutral",
        negative: "âš ï¸ Negative",
        rude: "ðŸ˜¡ Rude",
        urgent: "â³ Urgent",
        informal: "ðŸ˜„ Informal"
      };

      const keywordMap = {
        formal: ["dear", "sir", "madam", "regards", "sincerely", "request"],
        urgent: ["urgent", "immediately", "asap", "now"],
        appreciative: ["thank you", "thanks", "appreciate"],
        polite: ["please", "kindly", "could you"]
      };

      function highlightText(text, tone) {
        let highlighted = text;
        const color = toneColors[tone] || "#6c5ce7";

        for (const group in keywordMap) {
          keywordMap[group].forEach(word => {
            const regex = new RegExp(word, "gi");
            highlighted = highlighted.replace(
              regex,
              match =>
                `<span class="highlight" style="background:${color}33; color:${color}">${match}</span>`
            );
          });
        }

        return highlighted;
      }

      async function classify() {
        const text = document.getElementById("emailText").value;

        const res = await fetch("/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text })
        });

        const data = await res.json();

        const tone = data.tone;
        const color = toneColors[tone] || "#6c5ce7";

        document.getElementById("resultBox").style.display = "block";
        document.getElementById("toneLabel").innerText = tone;
        document.getElementById("toneLabel").style.background = color;

        document.getElementById("toneIcon").innerHTML = toneIcons[tone] || "";
        document.getElementById("methodLabel").innerText = data.method;

        // Highlight keywords
        document.getElementById("highlightBox").innerHTML = highlightText(text, tone);

        // Chart
        if (data.confidence !== null && data.confidence !== undefined) {
          document.getElementById("confidenceChart").style.display = "block";

          const ctx = document.getElementById("confidenceChart");

          if (chartInstance) {
            chartInstance.destroy();
          }

          chartInstance = new Chart(ctx, {
            type: "bar",
            data: {
              labels: ["Confidence"],
              datasets: [
                {
                  data: [data.confidence]
                }
              ]
            },
            options: {
              scales: {
                y: { beginAtZero: true, max: 1 }
              }
            }
          });
        }
      }
    </script>
  </body>
</html>
